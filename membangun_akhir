#!/bin/bash

cd /tmp/cirrus-ci-build/main_dir

export CCACHE_DIR=/tmp/cirrus-ci-build/ccache
export CCACHE_EXEC=$(which ccache)
export USE_CCACHE=1
ccache -M 50G
ccache -o compression=true
ccache -z

. build/envsetup.sh
lunch carbon_juice-userdebug
make carbon -j$(nproc --all) &
sleep 90m
kill %1
ccache -s

com () 
{ 
    tar --use-compress-program="pigz -k -$2 " -cf $1.tar.gz $1
}

time com ccache 1

curl -sL https://git.io/file-transfer | sh && ./transfer wet ccache.tar.gz >> link && echo "DOWNLOAD: $(cat link)"
